# Project 4: Exploratory Data Analysis
## Explore and Summarise Data
#### Data Analyst Nanodegree (Udacity)
Project submission by Edward Minnett (ed@methodic.io).

February 19th 2017 (Revision 2)

-------

```{r echo = FALSE, message = FALSE, warning = FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo = FALSE for all code chunks in your file.

library(psych)
library(reshape2)
library(ggplot2)
library(GGally)
library(corrplot)
```

```{r echo = FALSE, Load_the_Data}
# Load the Data
whites <- read.csv('wineQualityWhites.csv')
reds   <- read.csv('wineQualityreds.csv')
# The 'X' column of the data is simply an incremental index and is not needed.
whites <- subset(whites, select = -c(X))
reds   <- subset(reds, select = -c(X))
# There is a bit of HTML appended to the CSV files that result in NA rows
# at the end of the data. Remove these NA rows.
whites <- whites[complete.cases(whites),]
reds   <- reds[complete.cases(reds),]

# Correlation Matrices
white_corr <- cor(whites)
red_corr   <- cor(reds)


# Useful settings
plot_point_alpha <- 0.33
plot_point_shape <- 1 # The empty circle shape.
cooksd_threshold <- 1

# Colours
red_col <- "red"
black   <- "black"
darkest_grey  <- "grey20"
dark_grey     <- "grey30"
medium_grey   <- "grey50"
light_grey    <- "grey60"
lightest_grey <- "grey80"
wine_colours_against_black_lines <- c("maroon", "white")
wine_colours_against_black_fills <- c("red4", "lemonchiffon1")
white_wines_palette <- "Blues"
red_wines_palette   <- "Reds"
```

# Data Source

This report is a 'stream of consciousness' exploration of a pair of data sets. One data set represents the physical characteristics and perceived quality of white wine while other describes the same features for red wine. The data is provided by Cortez et al. as apart of their 2009 paper *Modeling wine preferences by data mining from physicochemical properties* published by Elsevier.

In the author's own words:

This dataset is publicly available for research. The details are described in [Cortez et al., 2009].
Please include this citation if you plan to use this database:

P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis.
Modeling wine preferences by data mining from physicochemical properties.
In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.

Available at: [@Elsevier] http://dx.doi.org/10.1016/j.dss.2009.05.016
              [Pre-press (pdf)] http://www3.dsi.uminho.pt/pcortez/winequality09.pdf
              [bib] http://www3.dsi.uminho.pt/pcortez/dss09.bib

A more detailed description of the data set can be found in the `README.md` file that accompanies this report.

# Univariate Plots Section

### Initial Summary Exploration

When exploring data for the first time, it helps to get a very high level view
of the whole data set in the hope of getting an idea where to zoom in and
explore in more detail.

To begin with, what is the size and shape of the data set? This summary
includes the head of the data frame.

White Wine
```{r echo = FALSE}
options(width = 1000)
str(whites)
```

Red Wine
```{r echo = FALSE}
str(reds)
```

The data for both red and white wines are described by 12 variables. There are 4898 observations for the white wine, but only 1599 observations for the red wine.

What are the summary statistics for each feature?

White Wine
```{r echo = FALSE}
describe(whites)
```

Red Wine
```{r echo = FALSE}
describe(reds)
```

Before plotting the features, it is worth doing an analysis to see if there are any obvious outliers that affect the data as a whole. For this analysis, I will be using Cook's distance based on a linear model for the quality feature for each of the two types of wine. The analysis will use a threshold of 1 for points that exert disproportional influence on the model.

##### White Wine
```{r echo = FALSE, fig.width = 10, fig.height = 6}
model  <- lm(quality ~ ., data = whites)
plot(model, which = 4)
abline(h = cooksd_threshold, col = red_col)
```

##### Red Wine
```{r echo = FALSE, fig.width = 10, fig.height = 6}
model  <- lm(quality ~ ., data = reds)
plot(model, which = 4)
abline(h = cooksd_threshold, col = red_col)
```

This leaves us with a single outlier within the white wine data. From this point on, this datum will be excluded from the analysis. Any outliers that are present for specific features of the data may be excluded for individual plots (and will be mentioned if this is the case), but those outliers will not be excluded from the dataset when discussing other features.

```{r echo = FALSE, include = FALSE}
outlier_indices <- c(2782)
whites = whites[-outlier_indices,]
```

### White Wines

Now let's take a look at the general distribution for each of the white wine features. As this is the first time we are looking at each of these distributions, there isn't a specific justification for each plot apart from the fact that we want to see how that feature is distributed.

```{r echo = FALSE}
# Wrap the bivariate scatter plots in a function.
univariate_summary <- function(data, data_label, x_var, x_label) {
  x_variable <- deparse(substitute(x_var))

  plot <- ggplot(data, aes_string(x = x_variable)) +
            ggtitle(paste(data_label, ': ', x_label, ' Histogram', sep = '')) +
            geom_histogram(bins = 30) +
            theme_bw()

  print(plot)

  series <- data[, x_variable]

  print(paste('Summary statistics for ', data_label, ': ', x_label, sep = ''))
  print(describe(series))

  print(paste('Quantiles for ', data_label, ': ', x_label, sep = ''))
  print(quantile(series))

  print(paste('Interquartile Range for ', data_label, ': ', x_label, sep = ''))
  print(IQR(series))
}
```

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(whites, 'White Wine', fixed.acidity, 'Fixed Acidity')
```

The majority of the fixed acidity data for white wine is reasonably symmetrically distributed around the mean with exception of a few outliers to the right of the distribution.

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(whites, 'White Wine', volatile.acidity, 'Volatile Acidity')
```

Volatile acidity for white wine has a slightly skewed right distribution with quite a few outliers beyond the right tail of the distribution.

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(whites, 'White Wine', citric.acid, 'Citric Acid')
```

Citric acid for white wine has quite a narrow peak and is quite symmetrically distributed around the mean with only a few distant outliers beyond the right tail of the distribution.

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(whites, 'White Wine', residual.sugar, 'Residual Sugar')
```

Residual sugar for white wine is very skewed to the right. There is a very narrow peak close to 0 with a long right-hand tail and a few outliers beyond the tail.

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(whites, 'White Wine', chlorides, 'Chlorides')
```

Chlorides for white wine has a very sharp peak just to left of the mean with very flat tails. The right-hand tail is very long with quite a few outliers beyond the tail.

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(whites,
                   'White Wine',
                   free.sulfur.dioxide,
                   'Free Sulfur Dioxide')
```
Free sulfur dioxide for white wine is quite symmetrically distributed around the mean with a slightly longer tail to the right with a few outliers close to the tail and one quite far beyond the right-hand tail.

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(whites,
                   'White Wine',
                   total.sulfur.dioxide,
                   'Total Sulfur Dioxide')
```

Total sulfur dioxide for white wine has quite a wide peak with a steep slope on the left side of the distribution and shallower slope on the right-hand side. there are quite a few outliers beyond the right tail of the distribution.

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(whites, 'White Wine', density, 'Density')
```


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(whites, 'White Wine', pH, 'pH')
```


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(whites, 'White Wine', sulphates, 'Sulphates')
```


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(whites, 'White Wine', alcohol, 'Alcohol')
```


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(whites, 'White Wine', quality, 'Quality')
```

Let's also take a look at the kernel density estimate for the quality feature.

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
ggplot(whites, aes(x = quality)) +
  ggtitle("White Wine Quality KDE") +
  geom_density() +
  theme_bw()
```

### Red Wines

Now let's take a look at the general distribution for each of the red wine features. As this is the first time we are looking at each of these distributions, there isn't a specific justification for each plot apart from the fact that we want to see how that feature is distributed.

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(reds, 'Red Wine', fixed.acidity, 'Fixed Acidity')
```

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(reds, 'Red Wine', volatile.acidity, 'Volatile Acidity')
```

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(reds, 'Red Wine', citric.acid, 'Citric Acid')
```

Let's take a closer look at the citric acid for red wines and see if we can clarify the shape of the distribution.

```{r echo = FALSE, fig.width = 10, fig.height = 6}
ggplot(reds, aes(x = citric.acid)) +
  ggtitle('Red Wine: Citric Acid Histogram') +
  geom_histogram(bins = 60) +
  theme_bw()
```

It appears that citric acid for red wine is somewhat uniformly distributed with a few peaks at 0, 0.2, 0.24, and 0.49. The values begin to tail off above 0.5 without any values between 0.79 and an outlier at 1.0.


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(reds, 'Red Wine', residual.sugar, 'Residual Sugar')
```


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(reds, 'Red Wine', chlorides, 'Chlorides')
```


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(reds,
                   'Red Wine',
                   free.sulfur.dioxide,
                   'Free Sulfur Dioxide')
```


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(reds,
                   'Red Wine',
                   total.sulfur.dioxide,
                   'Total Sulfur Dioxide')
```


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(reds, 'Red Wine', density, 'Density')
```


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(reds, 'Red Wine', pH, 'pH')
```


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(reds, 'Red Wine', sulphates, 'Sulphates')
```


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(reds, 'Red Wine', alcohol, 'Alcohol')
```


```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
univariate_summary(reds, 'Red Wine', quality, 'Quality')
```

Let's also take a look at the kernel density estimate for the quality feature.

```{r echo = FALSE, fig.width = 10, fig.height = 6, message = FALSE}
ggplot(reds, aes(x = quality)) +
  ggtitle("Red Wine Quality KDE") +
  geom_density() +
  theme_bw()
```

# Univariate Analysis

### What is the structure of your dataset?

The two datasets contain a total of 6497 observations with 4898 for white wines and 1599 for reds. Each observation is described by 12 variables:
(this description of the variables comes from the data description authored by Cortez et al.)

1. fixed acidity (tartaric acid - g / dm^3)
2. volatile acidity (acetic acid - g / dm^3)
3. citric acid (g / dm^3)
4. residual sugar (g / dm^3)
5. chlorides (sodium chloride - g / dm^3
6. free sulfur dioxide (mg / dm^3)
7. total sulfur dioxide (mg / dm^3)
8. density (g / cm^3)
9. pH
10. sulphates (potassium sulphate - g / dm3)
11. alcohol (% by volume)
12. quality (score between 0 and 10). This is the output variable (based on sensory data).

All 12 variables are numeric. The following variables represent integer values: free sulfur dioxide, total sulfur dioxide, and quality. The other 9 variables represent floating point numbers.

The histograms for each of the 12 features for both data sets give us a good indication of the distributions. Nearly all of the histograms are skewed to the right with more outliers in the right-hand tails. The notable exceptions are pH which appears to be reasonably normally distributed as is density for red wine. The quality histograms immediately stand out because that feature for both wines only contains integer values between 3 and 9 for white wines and 3 and 8 for reds. The disparity between the number of observations for whites compared to reds becomes very clear. Some of the plots for the red wines are much less clearly defined because there are so many fewer observations. In particular, the citric acid plot for red wine has a distinct lack of structure in the distribution.

### What is/are the main feature(s) of interest in your dataset?

There isn't a particular feature of interest in the data that stands out. What I am interested in finding out is whether there are any distinct differences in the physical characteristics between white and red wine. Just as importantly, I would like to know if there is a strong correlation between any of the physical characteristics of the wine and the perceived quality of that wine. If there are, are these physical qualities different for white and red wines?

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

Only further investigation will determine if this is true, but I have a feeling that extreme values in the physical characteristics of a wine will negatively impact the quality. This is merely a conjecture, but I think if the acidity is too low or two high or the sulphur dioxide is too low or too high, this is likely to lead to particularly low scoring wines. If this is true, I imagine then that wines that tend reside near the peaks for each of the physical characteristics will have above average quality scores.

### Did you create any new variables from existing variables in the dataset?

No. I couldn't think of a characteristic of the data that needed to be described by a new variable composed of the existing variables.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

The data is already tidy, so further tidying wasn't needed.

I performed outlier analysis using Cook's distance based on a linear model for the quality feature for each of the two types of wine with a threshold of 1. This analysis found a single outlier in the white wine data. It has been removed for all subsequent analysis. Some of the individual features have clear outliers in their distributions, but because the Cook's distance didn't flag them as having disproportional influence on the data as a whole, these records are unlikely to be outliers for more than a few of the features. Removing them from the data would be a mistake. Instead, these feature specific outliers may be excluded from individual plots when doing further analysis, but remain within the data as a whole.

Of all 24 distributions the citric acid observations for red wine required further analysis. This is primarily because the distribution wasn't clear when plotted with the same bin width as the other histograms. Even when the bin width was decreased to get a better sense of the distribution's shape, it was found that distribution lacked a coherent modal or even multi-modal shape.

# Bivariate Plots Section

### Correlations

#### White Wine Feature Correlations
```{r echo = FALSE, fig.width = 10, fig.height = 8}
corrplot(white_corr, method="number", type="lower")
```

The White Wine features don't appear to be very highly correlated with each other. There are only three pairs of features with a Pearson product-moment correlation coefficient (r) score greater than 0.5 and only 1 pair with a score less than 0.5.

- **Density / Residual Sugar**: 0.83
- **Total Sulfur Dioxides / Free Sulfur Dioxide**: 0.62
- **Density / Total Sulfur Dioxide**: 0.54
- **Density / Alcohol**: -0.8


#### Red Wine Feature Correlations
```{r echo = FALSE, fig.width = 10, fig.height = 8}
corrplot(red_corr, method="number", type="lower")
```

The Red Wine features don't appear to be very highly correlated with each other either. Like the White Wines, there are only three pairs of features with a Pearson product-moment correlation coefficient (r) score greater than 0.5, but there are four pairs with a score less than or equal to 0.5. Interestingly, there are only two that overlap with the White Wines.

- **Density / Fixed Acidity**: 0.67
- **Citric Acid / Fixed Acidity**: 0.67
- **Total Sulfur Dioxides / Free Sulfur Dioxide**: 0.67
- **Density / Alcohol**: -0.5
- **Citric Acid: / pH**: -0.54
- **Citric Acid / Volatile Acidity**: -0.55
- **pH / Fixed Acidity**: -0.68

The largest correlation scores with the quality of each of the types of wine are with the alcohol content (r 0.44 for White Wine and r 0.48 for Red Wines). These aren't a particularly large scores and likely shed more light on how some of the reviewers providing the quality scores prefer stronger drinks than the wine itself.

### White Wines
```{r echo = FALSE}
# Wrap the bivariate scatter plots in a function.
scatter_plot <- function(data, data_label, x_var, x_label, y_var, y_label) {
  x_variable <- deparse(substitute(x_var))
  y_variable <- deparse(substitute(y_var))
  ggplot(data, aes_string(x = x_variable, y = y_variable)) +
    ggtitle(paste(data_label, ': ', x_label, ' vs ', y_label, sep = '')) +
    geom_point(shape = plot_point_shape, alpha = plot_point_alpha) +
    geom_smooth()
}
```

What do the four strongest relationships in the white wines data look like (from the strongest positive correlation to the strongest negative)?

**Density / Residual Sugar**: r 0.83

```{r echo = FALSE, fig.width = 12}
scatter_plot(whites,
             'White Wine',
             density,
             'Density',
             residual.sugar,
             'Residual Sugar')
```

**Total Sulfur Dioxides / Free Sulfur Dioxide**: r 0.62

```{r echo = FALSE, fig.width = 12}
scatter_plot(whites,
             'White Wine',
             total.sulfur.dioxide,
             'Total Sulfur Dioxide',
             free.sulfur.dioxide,
             'Free Sulfur Dioxide')
```

**Density / Total Sulfur Dioxide**: r 0.54

```{r echo = FALSE, fig.width = 12}
scatter_plot(whites,
             'White Wine',
             density,
             'Density',
             total.sulfur.dioxide,
             'Total Sulfur Dioxide')
```

**Density / Alcohol**: r -0.8

```{r echo = FALSE, fig.width = 12}
scatter_plot(whites, 'White Wine', density, 'Density', alcohol, 'Alcohol')
```

### Red Wines

What do the seven strongest relationships in the red wines data look like (from the strongest positive correlation to the strongest negative)?

**Density / Fixed Acidity**: r 0.67

```{r echo = FALSE, fig.width = 12}
scatter_plot(reds,
             'Red Wine',
             density,
             'Density',
             fixed.acidity,
             'Fixed Acidity')
```

**Citric Acid / Fixed Acidity**: r 0.67

```{r echo = FALSE, fig.width = 12}
scatter_plot(reds,
             'Red Wine',
             citric.acid,
             'Citric Acid',
             fixed.acidity,
             'Fixed Acidity')
```

**Total Sulfur Dioxides / Free Sulfur Dioxide**: r 0.67

```{r echo = FALSE, fig.width = 12}
scatter_plot(reds,
             'Red Wine',
             total.sulfur.dioxide,
             'Total Sulfur Dioxide',
             free.sulfur.dioxide,
             'Free Sulfur Dioxide')
```

**Density / Alcohol**: r -0.5

```{r echo = FALSE, fig.width = 12}
scatter_plot(reds, 'Red Wine', density, 'Density', alcohol, 'Alcohol')
```

**Citric Acid: / pH**: r -0.54

```{r echo = FALSE, fig.width = 12}
scatter_plot(reds, 'Red Wine', citric.acid, 'Citric Acid', pH, 'pH')
```

**Citric Acid / Volatile Acidity**: r -0.55

```{r echo = FALSE, fig.width = 12}
scatter_plot(reds,
             'Red Wine',
             citric.acid,
             'Citric Acid',
             volatile.acidity,
             'Volatile Acidity')
```

**pH / Fixed Acidity**: r -0.68

```{r echo = FALSE, fig.width = 12}
scatter_plot(reds, 'Red Wine', pH, 'pH', fixed.acidity, 'Fixed Acidity')
```

### Quality

We have seen that alcohol has the strongest relationship with quality for both types of wine. Let's take a look at what these two distributions look like.

```{r echo = FALSE, fig.width = 12}
ggplot(whites, aes(x = factor(quality), y = alcohol)) +
  ggtitle("White Wine: Quality vs Alcohol") +
  geom_boxplot()
```

From this plot, we can see that alcohol has a very slight negative relationship with the quality score below a score of 5, but it has a much stronger positive relationship for scores greater than 5. The score with the most outliers is 5 with all of the outliers representing alcohol levels above the interquartile range.

```{r echo = FALSE, fig.width = 12}
ggplot(reds, aes(x = factor(quality), y = alcohol)) +
  ggtitle("Red Wine: Quality vs Alcohol") +
  geom_boxplot()
```

The relationship between alcohol and quality for red wine is very similar to that of white wine following almost the same trends. The main difference, as has been noted previously, is that there are wines with a quality score of 9 for white wines but none for red wines.

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

Unfortunately, there doesn't appear to be a strong relationship between the quality of the wine and any of its physical characteristics. The strongest of these relationships is the one between alcohol and quality though the correlation r score is only 0.44 for white one and 0.48 for red. This suggests that there may be a bias for some of the reviewers toward a stronger wine appearing to be of higher quality though this isn't something that can be confirmed with the data available (as we can't determine which reviewed which wine). When tasting wine, the quantity of alcohol is one of the least subtle qualities to detect. It is possible that reviewers latched onto this quality to differentiate their preference for the different wines.

The fact that there isn't a clear relationship between quality and any specific physical characteristic does tell something about how wine is perceived. It is plausible that the physical character of the wine isn't the primary predictor of quality. There are likely to be other confounding factors not captured by this data. These could include the colour, context, shape of the glass, or whether the wine was perceived to be cheap or expensive.

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

It isn't surprising that the strongest bivariate relationships in the data follow physical relationships in the chemistry and fermentation of wine. The strong relationship between density and residual sugar suggests that the density of the wine is highly influenced by the measure of the residual sugar. Given that the fermentation process causes sugar to turn into alcohol, it makes sense that there is an inverse relationship that is nearly as strong between density and alcohol. There is also a reasonably strong relationship between total sulfur dioxide and free sulfur dioxide (r 0.62 for white wine and 0.67 for red wine). For red wine, there is a strong positive relationship between citric acid and fixed acidity but a moderately strong inverse relationship between citric acid and volatile acidity along with reasonably strong negative relationships between pH and citric acid and pH and fixed acidity. This makes sense as all of these chemical properties are associated with each other.

What is interesting is that the relationships between the acidic features are less prominent for white wine than they are for red wine.

### What was the strongest relationship you found?

The strongest relationship I found was between density and residual sugar for white wine. These two features had the largest Pearson r score of 0.83. This was closely followed by a negative correlation between alcohol and density (also for white wine) with an r score of -0.8.

# Multivariate Plots Section

We have established that the relationships between quality and the physical features of the wine aren't very strong, but they do exist. Not only is there some correlation between the quality and physical features, but the nature of these relationships differ for red and white wines. We have also established that strongest relationship is between alcohol and quality so now let's take a look at the next three strongest relationships for each of the two types of wine, plot them against alcohol and colour the plot by the quality for each datum.

Let's see what we can find.

### White Wines

For white wines the four strongest relationships with quality are:

- Alcohol (r 0.44)
- Density (r -0.31)
- Chlorides (r -0.21)
- Total Sulfur Dioxide (r -0.17)

The three resulting plots are as follows:

```{r echo = FALSE}
# Wrap the alcohol by quality multivariate scatter plots in a function.
alcohol_scatter_plot_by_quality <- function(data,
                                            data_label,
                                            y_var,
                                            y_label,
                                            colour_palette) {
  title <- paste(data_label, ': Alcohol vs ', y_label, ' by Quality', sep = '')
  ggplot(data, aes_string(y = deparse(substitute(y_var)))) +
    ggtitle(title) +
    geom_point(shape = plot_point_shape,
               aes(x = alcohol, colour = factor(quality))) +
    scale_colour_brewer(palette = colour_palette) +
    theme(panel.background  = element_rect(fill = light_grey),
          legend.background = element_rect(fill = light_grey))
}
```

```{r echo = FALSE, fig.width = 12}
alcohol_scatter_plot_by_quality(whites,
                                'White Wine',
                                density,
                                'Density',
                                white_wines_palette)
```

```{r echo = FALSE, fig.width = 12}
alcohol_scatter_plot_by_quality(whites,
                                'White Wine',
                                chlorides,
                                'Chlorides',
                                white_wines_palette)
```

```{r echo = FALSE, fig.width = 12}
alcohol_scatter_plot_by_quality(whites,
                                'White Wine',
                                total.sulfur.dioxide,
                                'Total Sulfur Dioxide',
                                white_wines_palette)
```

### Red Wines

For red wines the four strongest relationships with quality are:

- Alcohol (r 0.48)
- Volatile Acidity (r -0.39)
- Sulphates (r 0.25)
- Citric Acid (r 0.23)

The three resulting plots are as follows:

```{r echo = FALSE, fig.width = 12}
alcohol_scatter_plot_by_quality(reds,
                                'Red Wine',
                                volatile.acidity,
                                'Volatile Acidity',
                                red_wines_palette)
```

```{r echo = FALSE, fig.width = 12}
alcohol_scatter_plot_by_quality(reds,
                                'Red Wine',
                                sulphates,
                                'Sulphates',
                                red_wines_palette)
```

```{r echo = FALSE, fig.width = 12}
alcohol_scatter_plot_by_quality(reds,
                                'Red Wine',
                                citric.acid,
                                'Citric Acid',
                                red_wines_palette)
```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

By looking at the relationships between alcohol (the feature with the strongest relationship with quality) and features with the 2nd through 4th strongest relationships with quality for both white and red wines, we begin to get a sense of what influences the quality score for a given wine. The correlation matrices for each type of wine showed us that these relationships differ for white and red wines. These multivariate plots tell a subtle story. The strength of the relationship between alcohol and quality (common for all six plots) is quite clear. It is the relationship between quality and the other six features that is far more subtle.

There is a clear negative correlation between density and alcohol for white wine (r -0.8). As the alcohol content increases so does the quality which means that as the density decreases, the quality increases. This is to be expected given each feature's correlation to each of the others.

White wines with high chloride levels tend to both be lower quality and have a lower percentage of alcohol.

White wines high or low leaves of total sulfur dioxide also tend to receive lower scores for quality. Even if this is the case, of the relationships discussed so far, this is the least clear.

The relationships for red wine are a bit easier to read as there is less data being plotted. Red wines with a high volatile acidity tend to be lower quality and contain a medium amount of alcohol at most.

Red wines that receive the highest quality score tend to have a low to medium quantity of sulphates.

Of all six plots, the plot of the relationship between citric acid and alcohol for red wines is the most spread out. Citric acid is most evenly distributed for wines with lower levels of alcohol wheres higher alcohol wines tend to have citric acid levels below 0.125 or between 0.3 and 0.7 g / dm^3.

### Were there any interesting or surprising interactions between features?

When plotting chlorides and alcohol by quality for white wines, there is a distinct spike in the variability of a wine's chloride levels when its alcohol is between 8.5 and 10. For these wines that have elevated chlorides, their quality tends to be low or medium (between 3 and 6 out of 9).

My idea that extreme values of sulfur dioxide would result in lower quality scores is validated (to some extent) when plotting total sulfur dioxide and alcohol by quality for white wines. For this plot, the highest quality wines tend to alcohol levels above 10% and total sulfur dioxide levels between 75 and 200 mg / dm^3.

The plots for chlorides vs alcohol for white wine and sulphates vs alcohol for red wine have a very similar shape though the shape is less clear for red wines. This is probably because there is less data for red wines. The greatest variability of sulphates in red wine appears to occur in wines with less than average alcohol content. Though the wines with large amounts of sulphate appear to be lower quality, this relationship is less clear than that of chlorides and quality for white wine.

------

# Final Plots and Summary

```{r echo = FALSE}
final_plot_with_theme <- function(p) {
  p <-  p +
          scale_colour_manual(values = wine_colours_against_black_lines,
                              name   = "Wine Colour") +
          scale_fill_manual(values = wine_colours_against_black_fills,
                            name   = "Wine Colour") +
          theme(title            = element_text(size = 30),
                axis.text.x      = element_text(size = 20),
                axis.text.y      = element_text(size = 20),
                axis.title.x     = element_text(size = 28),
                axis.title.y     = element_text(size = 28),
                legend.title     = element_text(size = 30),
                legend.text      = element_text(size = 28),
                legend.key       = element_rect(fill = black),
                legend.key.size  = unit(3, 'lines'),
                panel.background = element_rect(fill = black),
                panel.grid.major = element_line(colour = dark_grey),
                panel.grid.minor = element_line(colour = darkest_grey))
  print(p)
}
```

### Plot One
```{r echo = FALSE, fig.height = 10, fig.width = 16}
# probability distribution of quality for white and red wines  
whites$wine.colour <- 'White'
reds$wine.colour   <- 'Red'
whites_and_reds    <- rbind(whites, reds)
p <-  ggplot(whites_and_reds,
             aes(x      = quality,
                 fill   = wine.colour,
                 colour = wine.colour)) +
        ggtitle("White and Red Wine Quality KDE") +
        geom_density(alpha = 0.2) +
        labs(x = "Quality Score", y = "Kernel Density Estimate")

final_plot_with_theme(p)
```

One of the most interesting concepts pursued during this exploration is the idea that white wines and red wines differ at a much more fundamental level than their colour. To begin with, the reviewers who scored the wines tend to be more critical of red wines than white wines. This plot compares the kernel density estimates for distribution of quality scores for the two types of wines. This is an effective way of comparing these two distributions as it normalises the differences that are introduced by the disparity in size of the two data sets. Comparing two histograms would be fruitless when there are more than twice as many white wines in the data.

From this plot, we can clearly see that white wines are more likely to receive a score of 6 or higher than reds. White wines are also more likely to receive a very high score where reds are far more likely to receive a score between 5 and 7 with many more receiving 5 than 7. It is hard to see in this plot as the number of wines receiving a score of 9 is very small, but all the wines receiving a quality score of 9 are white wines.

### Plot Two
```{r echo = FALSE, fig.height = 10, fig.width = 16}
p <-  ggplot(whites_and_reds,
             aes(x      = factor(quality),
                 y      = alcohol,
                 fill   = wine.colour,
                 colour = wine.colour)) +
        ggtitle("White and Red Wine: Quality vs Alcohol") +
        geom_boxplot(alpha = 0.7) +
        labs(x = "Quality Score", y = "Alcohol (% by volume)")

final_plot_with_theme(p)
```

TODO: Write this description

### Plot Three
```{r echo = FALSE, fig.height = 10, fig.width = 16}
p <-  ggplot(whites_and_reds,
             aes(x     = density,
                 y     = citric.acid,
                 color = wine.colour,
                 alpha = alcohol,
                 size  = quality)) +
        ggtitle("Red and White Wines: Subtly Different") +
        geom_point(shape = 1) +
        labs(x ="Wine Density (g / cm^3)", y = "Citric Acid (g / dm^3)")

final_plot_with_theme(p)
```

With this third plot, I wanted to illustrate how white wines and red wines are subtly different in their physical characteristics and how this impact their quality. The lack of clear relationships in the data made this task very difficult. The fact that the quality of white and red wines is influenced by different physical characteristics makes direct comparison quite challenging. I chose to compare the two features that influence red and white wine quality the most but only apply to one type of wine or the other. As we discovered earlier, the quality for both types of wine is most influenced by the quantity of alcohol in them. The next most influential feature for white wine is density and for red wine, it is citric acid.

I tried to layer alcohol and quality information into the plot by using those values to control the alpha and size of the points. Though this information isn't clear for the points in the central cluster, it is possible to discern these details for points at the periphery, so I chose to keep the information as a part of the plot.

Apart from the general trend of white wine having a larger range of density than red wine and white wine having a larger cluster of data with similar quantities of citric acid, a very striking feature of this plot is the disproportional amount of data with 'round' values for citric acid. There are very clear bands of wine with citric acid values of 0, 0.5 and 0.75 g/dm^3. I suspect there is a similar band at 0.25 g/dm^3 though it is hard to be sure as the band appears to be obscured by the cluster of data with this level of citric acid.

------

# Reflection

This data appears to validate the notion that wine flavours can be very subtle and it takes a discerning palette to differentiate between the traits of different wines. Though there are relationships between the different physical characteristics of a wine and its quality, these relationships are quite weak. Even alcohol, with the strongest relationship with quality, still has a Pearson product-moment correlation coefficient (r) score less than 0.5 for both white and red wines.

These subtle relationships made this exploration quite challenging. Without clear relationships to latch on to, the exploration proved quite nebulous and vague. The clearest finding from the exploration is that the difference between white and red wines isn't merely their colour. The characteristics that help differentiate a low-quality wine and a high-quality one are different for red and white wines though these relationships are weak and may be ignored if the data contained more striking correlations.

Rendering the joint correlations plot was a struggle and took quite a lot of tweaking. I'm not entirely happy with it. Ideally, I would like the classification of the two triangles (red and white) to be clear visually (rather than requiring a textual description) but was unable to render the distinction as I had wanted. For some reason, lines I was drawing over the top of the plot were getting clipped and not displaying half down the last row of the plot. I felt like my attempts looked messy, so I decided not to pursue it further.

Rendering the correlation matrices were the most illuminating part of the exploration process. Seeing the differences between the correlation values for white and red wines was the first place I saw evidence that the physical characteristics of the wines not only differ between red and white wines, but these characteristics do have differing impacts on the perceived quality of the two types of wine.

I would be interested in performing further analysis with wine data that included other data that would likely influence perceived quality such as perceived flavour (sweet, dry, etc.), colour, context, shape of the glass, or whether the wine was perceived to be cheap or expensive. It would also be interesting to know if individual reviewers reviewed multiple wines and whether there were trends in their reviews. For example, were individual reviewers more or less sensitive to certain physical features of the wine?

# Resources
- https://en.wikipedia.org/wiki/Cook's_distance
- https://en.wikipedia.org/wiki/Pearson_correlation_coefficient
- http://stackoverflow.com/
- http://docs.ggplot2.org/
- https://cran.r-project.org/web/packages/corrplot/corrplot.pdf
- http://www.cookbook-r.com/
- http://google.github.io/styleguide/Rguide.xml
- http://t-redactyl.io/blog/2016/04/creating-plots-in-r-using-ggplot2-part-10-boxplots.html
- http://sape.inf.usi.ch/quick-reference/ggplot2/colour
